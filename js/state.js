/* ========================================================================== */
/* ğŸ“Œ ç³»çµ±ç‹€æ…‹èˆ‡ä½¿ç”¨è€…è³‡è¨Š (System State & User Info)                           */
/* ========================================================================== */

// ç›®å‰ç™»å…¥çš„ Firebase ä½¿ç”¨è€…ç‰©ä»¶
let currentUser = null;

// æ˜¯å¦ç‚ºè¨»å†Šæ¨¡å¼ (æ§åˆ¶ç™»å…¥é é¢ç‹€æ…‹)
let isRegisterMode = false;

// ç›®å‰é¡¯ç¤ºçš„ä½¿ç”¨è€…åç¨± (é è¨­ç‚ºåŒå­¸)
let userTitle = "åŒå­¸";

// å„²å­˜å­¸æ ¡èˆ‡ç§‘ç³»è³‡è¨Šçš„ç‰©ä»¶
let userSchoolInfo = { school: "", department: "" };



/* ========================================================================== */
/* ğŸ“Œ å­¸æœŸèˆ‡æ™‚é–“è¨­å®š (Semester & Time Settings)                                 */
/* ========================================================================== */

// ç›®å‰é¸æ“‡çš„æ˜ŸæœŸ (é è¨­ç‚ºä»Šå¤©ï¼Œè‹¥é€±æ—¥0å‰‡è½‰ç‚º1)
let currentDay = new Date().getDay();
if (currentDay === 0 || currentDay === 6) currentDay = 1;

// ç›®å‰é¸æ“‡çš„å­¸æœŸä»£è™Ÿ
let currentSemester = "114-1";

// å„²å­˜æ‰€æœ‰å¯ç”¨çš„å­¸æœŸæ¸…å–®
let semesterList = ["114-1"];

// ç•¶å‰å­¸æœŸçš„é–‹å§‹æ—¥æœŸ
let semesterStartDate = "";

// ç•¶å‰å­¸æœŸçš„çµæŸæ—¥æœŸ
let semesterEndDate = "";

// èª²å ‚æ™‚é–“è¨­å®šé è¨­å€¼ (ä¸Šèª²ã€ä¸‹èª²æ™‚é–“èˆ‡é¦–ç¯€é–‹å§‹æ™‚é–“)
let periodConfig = { classDur: 50, breakDur: 10, startHash: "08:10" };

// å„²å­˜å„ç¯€æ¬¡ç¨ç«‹æ™‚é–“çš„è¨­å®š
let periodTimesConfig = {};

// é è¨­çš„ç¯€æ¬¡ä»£ç¢¼åˆ—è¡¨ (å¯è‡ªè¨‚)
let customPeriods = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D'];



/* ========================================================================== */
/* ğŸ“Œ å„æ¨¡çµ„è³‡æ–™æš«å­˜è®Šæ•¸ (Module Data Storage)                                  */
/* ========================================================================== */

// å„²å­˜æ‰€æœ‰å­¸æœŸçš„å®Œæ•´è³‡æ–™çµæ§‹
let allData = {};

// é è¨­çš„èª²è¡¨çµæ§‹ (é€±ä¸€åˆ°é€±äº”ï¼Œç¯€æ¬¡ç‚ºç©ºé™£åˆ—)
const defaultSchedule = { 1: [], 2: [], 3: [], 4: [], 5: [] };

// ç•¶å‰å­¸æœŸçš„é€±èª²è¡¨è³‡æ–™
let weeklySchedule = {};

// ç•¶å‰å­¸æœŸçš„å¹³å¸¸è€ƒè³‡æ–™
let regularExams = {};

// ç•¶å‰å­¸æœŸçš„æ®µè€ƒè³‡æ–™
let midtermExams = {};

// ç•¶å‰å­¸æœŸçš„æˆç¸¾è³‡æ–™
let gradeList = [];

// ç•¶å‰å­¸æœŸçš„è¡Œäº‹æ›†è³‡æ–™
let calendarEvents = [];

// ç•¶å‰å­¸æœŸçš„è¨˜å¸³è³‡æ–™
let accountingList = [];

// å¿«é€Ÿç­†è¨˜çš„è³‡æ–™åˆ—è¡¨
let quickNotes = [];

// å­¸æœŸæˆç¸¾è¨ˆç®—çš„ç­†è¨˜è³‡æ–™
let gradeCalcNotes = [];

// ç´€å¿µæ—¥è¿½è¹¤çš„è³‡æ–™åˆ—è¡¨
let anniversaryList = [];

// å­¸ç¿’è¨ˆç•«èˆ‡é€²åº¦çš„è³‡æ–™åˆ—è¡¨
let learningList = [];

// ç±¤ç­’æ¨¡çµ„çš„è³‡æ–™åˆ—è¡¨
let lotteryList = [];

// ä½œæ¥­ç®¡ç†çš„è³‡æ–™åˆ—è¡¨
let homeworkList = [];



/* ========================================================================== */
/* ğŸ“Œ ç³»çµ±é è¨­åˆ†é¡èˆ‡ç›®æ¨™è¨­å®š (System Defaults & Targets)                        */
/* ========================================================================== */

// è¨˜å¸³åœ–è¡¨çš„ Chart.js å¯¦ä¾‹æš«å­˜
let accChartInstance = null;

// ç•¢æ¥­å­¸åˆ†ç›®æ¨™ (é è¨­ç‚º 128 å­¸åˆ†)
let graduationTarget = 128;

// é è¨­çš„æ”¯ä»˜æ–¹å¼åˆ—è¡¨ (ç¾é‡‘ã€åˆ·å¡ç­‰)
let paymentMethods = [ "ç¾é‡‘", "ä¸€å¡é€š", "æ‚ éŠå¡", "ä¿¡ç”¨å¡", "è¡Œå‹•æ”¯ä»˜", "è½‰å¸³" ];

// é è¨­çš„æ”¶æ”¯åˆ†é¡åˆ—è¡¨ (åŒ…å«æ”¶å…¥èˆ‡æ”¯å‡ºé¡åˆ¥)
let accCategories = {
    expense: [ "é£²é£Ÿ", "äº¤é€š", "è³¼ç‰©", "ç”Ÿæ´»ç”¨å“", "ç¶²è·¯è²»", "å…¶ä»–" ],
    income: [ "è–ªæ°´", "é›¶ç”¨éŒ¢", "çé‡‘", "æŠ•è³‡", "å…¶ä»–" ]
};

// æ¨¡çµ„é¡åˆ¥çš„ç›®æ¨™å€¼è¨­å®š (å¦‚è‡ªç”±é¸ä¿®å­¸åˆ†ç­‰)
let categoryTargets = { "è‡ªç”±é¸ä¿®": 20 };



/* ========================================================================== */
/* ğŸ“Œ ä½¿ç”¨è€…åå¥½èˆ‡æ¨¡çµ„è‡ªè¨‚ (User Preferences & Modular UI)                      */
/* ========================================================================== */

// ç´€éŒ„ä½¿ç”¨è€…çš„å°è¦½ç‹€æ…‹èˆ‡è‡ªè¨‚é¦–é é…ç½®
let userPreferences = {
    onboarded: false,
    primaryGoal: 'all', 
    activeApps: ['schedule', 'grade-manager', 'homework', 'accounting', 'calendar']
};

// ç³»çµ±æ‰€æœ‰å¯ç”¨çš„ App æ¨¡çµ„æ¸…å–®
const allAvailableApps = [
    { id: 'schedule', icon: 'ğŸ“…', color: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', label: 'èª²è¡¨' },
    { id: 'lottery', icon: 'ğŸ°', color: 'linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%)', label: 'å¹¸é‹ç±¤ç­’' },
    { id: 'calendar', icon: 'ğŸ—“ï¸', color: 'linear-gradient(135deg, #fccb90 0%, #d57eeb 100%)', label: 'è¡Œäº‹æ›†' },
    { id: 'grade-manager', icon: 'ğŸ’¯', color: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', label: 'æˆç¸¾ç®¡ç†' },
    { id: 'grade-calc', icon: 'ğŸ§®', color: 'linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)', label: 'é…åˆ†ç­†è¨˜' },
    { id: 'homework', icon: 'ğŸ’', color: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)', label: 'ä½œæ¥­æˆç¸¾' },
    { id: 'accounting', icon: 'ğŸ’°', color: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', label: 'å­¸æœŸè¨˜å¸³' },
    { id: 'notes', icon: 'ğŸ“', color: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)', label: 'å¿«è¿°è¨˜äº‹' },
    { id: 'anniversary', icon: 'ğŸ’', color: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)', label: 'ç´€å¿µæ—¥' },
    { id: 'learning', icon: 'ğŸ“š', color: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)', label: 'å­¸ç¿’é€²åº¦' },
];